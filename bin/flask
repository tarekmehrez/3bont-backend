import config

from bson import json_util


from flask import Flask, Response, request
import json
from talata_bont_backend.db import MongoInterface

app = Flask(__name__)

config_dict = config.get_config_dict()
db_args = config_dict['mongodb']

db = MongoInterface(db_args['host'],
                    int(db_args['port']),
                    db_args['db_name'])


@app.route('/timeline/page_num', methods=['GET'])
def api_timeline(page_num):
    items = list(db.find('timeline_items', {}, True))
    data = json.dumps(items, default=json_util.default)
    if page_num == 1:
        data = data[1:page_num * 10]
    else:
        data = data[(page_num - 1) * 10:page_num * 10]

    resp = Response(data, status=200, mimetype='application/json')

    return resp


@app.route('/timeline/filter/', methods=['GET'])
def api_timeline_filtered():
    if 'src' in request.args:
        items = list(db.find('timeline_items', {
                     'src': request.args['src']}, True))
    elif 'type' in request.args:
        items = list(db.find('timeline_items', {
                     'type': request.args['type']}, True))

    data = json.dumps(items, default=json_util.default)
    resp = Response(data, status=200, mimetype='application/json')

    return resp

if __name__ == '__main__':
<<<<<<< HEAD
    app.run(host='46.101.101.104')
=======
    app.run()

1 - 10
10 - 20
20 - 30
>>>>>>> b784f4692eb7d5c25796c540637fe9e4116a6560
